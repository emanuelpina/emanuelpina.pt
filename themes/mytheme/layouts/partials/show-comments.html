{{ if isset $.Site.Data.comments .Section }}
  {{ $comments := index $.Site.Data.comments (.Section) (.File.ContentBaseName) }}
  {{ if $comments }}
<section class="post-comments" id="comentarios">
  <h4 class="post-comments-title">{{ len $comments  }}{{ if gt (len $comments) 1 }} comentários{{ else }} comentário{{ end }}</h4>

  {{ $hasComments := 0 }}
  {{ range $comments }}
    {{ $hasComments = add $hasComments 1 }}
    {{ if not .reply_to }}
      {{ $parentId := ._id }}
      {{ $parentName := .name }}
      {{ $hasReplies := 0 }}
    <div id="{{ ._id }}" class="post-comments-thread">
      <div class="post-comment">
        <img class ="post-comment-avatar" src="https://www.gravatar.com/avatar/{{ .email }}?s=80">
        <span class="post-comment-author">{{ .name }}</span>
        {{ $dateMonth := (dateFormat "1" .date)}}
        <span class="post-comment-date">{{ dateFormat "2" .date }} {{ index $.Site.Data.meses (printf "%s" $dateMonth) }} {{ dateFormat "2006" .date }} às {{ dateFormat  "15:04" .date }}</span>
        <div class="post-comment-body">{{ .body | markdownify }}</div>
        {{ range $comments }}
          {{ if eq .reply_to $parentId }}
            {{ $hasReplies = add $hasReplies 1 }}
          {{ end }}
        {{ end }}
        {{ if eq $hasReplies 0 }}
          <button class="post-comment-reply-button" type="button" replyto="{{ ._id }}" replyto-name="a {{ .name }}">Responder</button>  
        {{ end }}
      </div>
      {{ range $comments }}
        {{ if eq .reply_to $parentId }}
        <div class="post-comment-reply">
          <img class ="post-comment-avatar" src="https://www.gravatar.com/avatar/{{ .email }}?s=80">
          <span class="post-comment-author">{{ .name }}</span>
          {{ $dateMonth := (dateFormat "1" .date)}}
          <span class="post-comment-date">{{ dateFormat "2" .date }} {{ index $.Site.Data.meses (printf "%s" $dateMonth) }} {{ dateFormat "2006" .date }} às {{ dateFormat  "15:04" .date }}</span>
          <div class="post-comment-body">{{ .body | markdownify }}</div>
          {{ if gt $hasReplies 0 }}
            <button class="post-comment-reply-button" type="button" replyto="{{ $parentId }}" replyto-name="à conversa">Responder</button>  
          {{ end }}
        </div>
        {{ end }}
      {{ end }}
    </div>
    {{ end }}
  {{ end }}
</section>
  {{ end }}
{{ end }}
